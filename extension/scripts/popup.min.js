"use strict";async function c(o,e){let t=await fetch(o,e),n=t.headers.get("X-Rate-Limit-Limit"),i=t.headers.get("X-Rate-Limit-Reset"),a=t.headers.get("X-Rate-Limit-Remaining"),s={limit:n?Number(n):void 0,reset:i?Number(i):void 0,remaining:a?Number(a):void 0};return await chrome.storage.sync.set({["legacy-api"]:s}),t.json()}function m(o){return c(`${"https://www.v2ex.com/api"}/topics/latest.json`,o)}function u(o){return c(`${"https://www.v2ex.com/api"}/topics/hot.json`,o)}function p(o){let e=new Date(o*1e3),t=e.getFullYear().toString(),n=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0");return`${t}-${n}-${i}`}function g(){let o=document.querySelector("#save");chrome.storage.sync.get("api",t=>{let n=document.querySelector("#pat"),i=document.querySelector("#limit"),a=document.querySelector("#reset"),s=document.querySelector("#remaining"),r=t["api"];n instanceof HTMLInputElement&&i instanceof HTMLInputElement&&a instanceof HTMLInputElement&&s instanceof HTMLInputElement&&r&&(n.value=r.pat??"",i.value=String(r.limit),a.value=r.reset?p(r.reset):"",s.value=String(r.remaining))}),chrome.storage.sync.get("legacy-api",t=>{let n=document.querySelector("#limitv1"),i=document.querySelector("#resetv1"),a=document.querySelector("#remainingv1"),s=t["legacy-api"];n instanceof HTMLInputElement&&i instanceof HTMLInputElement&&a instanceof HTMLInputElement&&s&&(n.value=String(s.limit),i.value=String(s.reset),a.value=String(s.remaining))});async function e(){let t=document.querySelector("#pat");if(t instanceof HTMLInputElement&&t.value.length>0){let n={pat:t.value};await chrome.storage.sync.set({["api"]:n})}}o instanceof HTMLButtonElement&&o.addEventListener("click",()=>{e()})}function d(){$(".tabs > li").on("click",e=>{let t=$(e.currentTarget),n=t.data("target");if(typeof n!="string")return;let i=$(`#${n}`);t.addClass("active").siblings().removeClass("active"),i.addClass("active").siblings().removeClass("active")});let o=e=>e.map(t=>`
          <li class="topic-item">
            <a href="${t.url}" target="_blank">
              <span class="title">${t.title}</span>
              <span class="content">${t.content}</span>
            </a>
          </li>
          `).join("");u().then(e=>{$(".topics.hot").append(o(e))}).catch(e=>{console.error(e)}),m().then(e=>{$(".topics.latest").append(o(e))}).catch(e=>{console.error(e)})}window.addEventListener("load",()=>{g(),d()});
