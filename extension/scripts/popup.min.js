"use strict";async function c(e,i){let n=await fetch(e,i),t=n.headers.get("X-Rate-Limit-Limit"),o=n.headers.get("X-Rate-Limit-Reset"),a=n.headers.get("X-Rate-Limit-Remaining"),s={limit:t?Number(t):void 0,reset:o?Number(o):void 0,remaining:a?Number(a):void 0};return await chrome.storage.sync.set({["legacy-api"]:s}),n.json()}function m(e){return c(`${"https://www.v2ex.com/api"}/topics/latest.json`,e)}function p(e){return c(`${"https://www.v2ex.com/api"}/topics/hot.json`,e)}function l(e){let i=new Date(e*1e3),n=i.getFullYear().toString(),t=(i.getMonth()+1).toString().padStart(2,"0"),o=i.getDate().toString().padStart(2,"0");return`${n}-${t}-${o}`}function d(){let e=document.querySelector("#save");chrome.storage.sync.get("api",n=>{let t=document.querySelector("#pat"),o=document.querySelector("#limit"),a=document.querySelector("#reset"),s=document.querySelector("#remaining"),r=n["api"];t instanceof HTMLInputElement&&o instanceof HTMLInputElement&&a instanceof HTMLInputElement&&s instanceof HTMLInputElement&&r&&(t.value=r.pat??"",o.value=String(r.limit),a.value=r.reset?l(r.reset):"",s.value=String(r.remaining))}),chrome.storage.sync.get("legacy-api",n=>{let t=document.querySelector("#limitv1"),o=document.querySelector("#resetv1"),a=document.querySelector("#remainingv1"),s=n["legacy-api"];t instanceof HTMLInputElement&&o instanceof HTMLInputElement&&a instanceof HTMLInputElement&&s&&(t.value=String(s.limit),o.value=String(s.reset),a.value=String(s.remaining))});async function i(){let n=document.querySelector("#pat");if(n instanceof HTMLInputElement&&n.value.length>0){let t={pat:n.value};await chrome.storage.sync.set({["api"]:t})}}e instanceof HTMLButtonElement&&e.addEventListener("click",()=>{i()})}function f(){let e=({tabId:t,tabEle:o}={})=>{let a=s=>{let r=s.data("target");if(typeof r=="string"){let u=$(`#${r}`);s.addClass("active").siblings().removeClass("active"),u.addClass("active").siblings().removeClass("active"),window.scrollTo(0,0)}};a(t?$(`.tabs > li[data-target="${t}"]`):o||$(".tabs > li:first-child"))},i=window.localStorage.getItem("v2p_popup");if(i){let t=JSON.parse(i);e({tabId:t.lastActiveTab})}else e();$(".tabs > li").on("click",t=>{e({tabEle:$(t.currentTarget)})});let n=t=>t.map(o=>`
          <li class="topic-item">
            <a href="${o.url}" target="_blank">
              <span class="title">${o.title}</span>
              <span class="content">${o.content}</span>
            </a>
          </li>
          `).join("");p().then(t=>{$(".topics.hot").append(n(t))}).catch(t=>{console.error(t)}),m().then(t=>{$(".topics.latest").append(n(t))}).catch(t=>{console.error(t)})}window.addEventListener("load",()=>{d(),f()});window.addEventListener("beforeunload",()=>{let e=$(".tabs > li.active").data("target");if(typeof e=="string"){let i={lastActiveTab:e};window.localStorage.setItem("v2p_popup",JSON.stringify(i))}});
