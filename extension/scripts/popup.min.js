"use strict";async function c(n,t){let e=await fetch(n,t),o=e.headers.get("X-Rate-Limit-Limit"),i=e.headers.get("X-Rate-Limit-Reset"),a=e.headers.get("X-Rate-Limit-Remaining"),s={limit:o?Number(o):void 0,reset:i?Number(i):void 0,remaining:a?Number(a):void 0};return await chrome.storage.sync.set({["legacy-api"]:s}),e.json()}function m(n){return c(`${"https://www.v2ex.com/api"}/topics/latest.json`,n)}function u(n){return c(`${"https://www.v2ex.com/api"}/topics/hot.json`,n)}function p(n){let t=new Date(n*1e3),e=t.getFullYear().toString(),o=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0");return`${e}-${o}-${i}`}function d(){let n=document.querySelector("#save");chrome.storage.sync.get("api",e=>{let o=document.querySelector("#pat"),i=document.querySelector("#limit"),a=document.querySelector("#reset"),s=document.querySelector("#remaining"),r=e["api"];o instanceof HTMLInputElement&&i instanceof HTMLInputElement&&a instanceof HTMLInputElement&&s instanceof HTMLInputElement&&r&&(o.value=r.pat??"",i.value=String(r.limit),a.value=r.reset?p(r.reset):"",s.value=String(r.remaining))}),chrome.storage.sync.get("legacy-api",e=>{let o=document.querySelector("#limitv1"),i=document.querySelector("#resetv1"),a=document.querySelector("#remainingv1"),s=e["legacy-api"];o instanceof HTMLInputElement&&i instanceof HTMLInputElement&&a instanceof HTMLInputElement&&s&&(o.value=String(s.limit),i.value=String(s.reset),a.value=String(s.remaining))});async function t(){let e=document.querySelector("#pat");if(e instanceof HTMLInputElement&&e.value.length>0){let o={pat:e.value};await chrome.storage.sync.set({["api"]:o})}}n instanceof HTMLButtonElement&&n.addEventListener("click",()=>{t()})}function g(){let n=t=>t.map(e=>`
          <li class="topic-item">
            <div class="title"><a href="${e.url}" target="_blank">${e.title}</a></div>
            <div class="content">${e.content}</div>
          </li>
          `).join("");u().then(t=>{$(".topics.hot").append(n(t))}).catch(t=>{console.error(t)}),m().then(t=>{$(".topics.latest").append(n(t))}).catch(t=>{console.error(t)})}window.addEventListener("load",()=>{d(),g()});
