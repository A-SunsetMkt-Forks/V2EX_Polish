"use strict";async function A(t,n){let i=await fetch(t,n),e=i.headers.get("X-Rate-Limit-Limit"),o=i.headers.get("X-Rate-Limit-Reset"),c=i.headers.get("X-Rate-Limit-Remaining");return chrome.storage.sync.get("api",s=>{let r={pat:s["api"]?.pat,limit:e?Number(e):void 0,reset:o?Number(o):void 0,remaining:c?Number(c):void 0};chrome.storage.sync.set({["api"]:r})}),i.json()}function f(t,n){return A(`${"https://www.v2ex.com/api/v2"}/topics/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}})}var w=$('#Top .tools > a[href^="/member"]').text(),R=$("#Main > .box:nth-child(1) > .header > small > a").text(),h=$("#Main #Tabs ~ .cell.item"),N=$("#Main .box:has(.topic_content)"),y=$('#Main .box:has(.cell[id^="r_"])'),u=y.find('.cell[id^="r_"]'),P=u.find("> table > tbody > tr"),D=P.map((t,n)=>{let i=u[t].id,e=$(n).find("> td:nth-child(3)"),o=e.find("> strong > a"),c=o.text(),s=o.prop("href"),r=e.find("> .reply_content").text(),a=Number(e.find("span.small").text()),m=e.find("span.no").text(),p=Array.from(r.matchAll(/@(\S+)\s/g)),x=p.length>0?p.map(([,d])=>d):void 0,l=Array.from(r.matchAll(/#(\d+)/g)),b=l.length>0?l.map(([,d])=>d):void 0;return{id:i,memberName:c,memberLink:s,content:r,likes:a,floor:m,index:t,refMemberNames:x,refFloors:b}}).get();function g(){chrome.storage.sync.get("api",t=>{console.log({result:t});let n=t["api"]?.pat;n&&h.each((i,e)=>{let o=$(e);$('<button class="v2p-topic-preview-btn">\u9884\u89C8</button>').on("click",()=>{let s=o.find(".topic-link").attr("href")?.match(/\/(\d+)#/);if(s){let r=s[1];f(r,n).then(a=>{let m=a.result;$(`
                <div class="v2p-topic-preview">
                  <div class="v2p-topic-preview__title">${m.title}</div>
                  <div class="v2p-topic-preview__content">${m.content_rendered}</div>
                </div>
                `).appendTo(o)}).catch(a=>{console.error(a)})}}).prependTo(o.find(".topic_info"))})})}$("#Main .tab").addClass("v2p-hover-btn"),$('#Main .topic-link, .item_hot_topic_title > a, .item_node, a[href="/write"]').prop("target","_blank").prop("rel","noopener noreferrer");g();
