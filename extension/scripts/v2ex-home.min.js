"use strict";async function x(e,n){let i=await fetch(e,n),t=i.headers.get("X-Rate-Limit-Limit"),o=i.headers.get("X-Rate-Limit-Reset"),c=i.headers.get("X-Rate-Limit-Remaining");return chrome.storage.sync.get("api",r=>{let s={pat:r["api"]?.pat,limit:t?Number(t):void 0,reset:o?Number(o):void 0,remaining:c?Number(c):void 0};chrome.storage.sync.set({["api"]:s})}),i.json()}function f(e,n){return x(`${"https://www.v2ex.com/api/v2"}/topics/${e}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}})}var w=$('#Top .tools > a[href^="/member"]').text(),M=$("#Main > .box:nth-child(1) > .header > small > a").text(),u=$("#Main #Tabs ~ .cell.item"),_=$("#Main .box:has(.topic_content)"),I=$('#Main .box:has(.cell[id^="r_"])'),h=I.find('.cell[id^="r_"]'),A=h.find("> table > tbody > tr"),R=A.map((e,n)=>{let i=h[e].id,t=$(n).find("> td:nth-child(3)"),o=t.find("> strong > a"),c=o.text(),r=o.prop("href"),s=t.find("> .reply_content").text(),a=Number(t.find("span.small").text()),m=t.find("span.no").text(),p=Array.from(s.matchAll(/@([a-zA-Z0-9]+)/g)),b=p.length>0?p.map(([,d])=>d):void 0,l=Array.from(s.matchAll(/#(\d+)/g)),v=l.length>0?l.map(([,d])=>d):void 0;return{id:i,memberName:c,memberLink:r,content:s,likes:a,floor:m,index:e,refMemberNames:b,refFloors:v}}).get();function g(){chrome.storage.sync.get("api",e=>{console.log({result:e});let n=e["api"]?.pat;n&&u.each((i,t)=>{let o=$(t);$('<button class="v2p-topic-preview-btn">\u9884\u89C8</button>').on("click",()=>{let r=o.find(".topic-link").attr("href")?.match(/\/(\d+)#/);if(r){let s=r[1];f(s,n).then(a=>{let m=a.result;$(`
                <div class="v2p-topic-preview">
                  <div class="v2p-topic-preview__title">${m.title}</div>
                  <div class="v2p-topic-preview__content">${m.content_rendered}</div>
                </div>
                `).appendTo(o)}).catch(a=>{console.error(a)})}}).prependTo(o.find(".topic_info"))})})}$("#Main .tab").addClass("v2p-hover-btn"),$('#Main .topic-link, .item_hot_topic_title > a, .item_node, a[href="/write"]').prop("target","_blank").prop("rel","noopener noreferrer");g();
