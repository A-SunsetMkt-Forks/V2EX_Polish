"use strict";async function y(t,n){let i=await fetch(t,n),e=i.headers.get("X-Rate-Limit-Limit"),o=i.headers.get("X-Rate-Limit-Reset"),s=i.headers.get("X-Rate-Limit-Remaining");return chrome.storage.sync.get("api",a=>{let r={pat:a["api"]?.pat,limit:e?Number(e):void 0,reset:o?Number(o):void 0,remaining:s?Number(s):void 0};chrome.storage.sync.set({["api"]:r})}),i.json()}function f(t,n){return y(`${"https://www.v2ex.com/api/v2"}/topics/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}})}var T=$('#Top .tools > a[href^="/member"]').text(),N=$("#Main > .box:nth-child(1) > .header > small > a").text(),h=$("#Main #Tabs ~ .cell.item"),R=$("#Main .box:has(.topic_content)"),I=$('#Main .box:has(.cell[id^="r_"])'),g=I.find('.cell[id^="r_"]'),P=g.find("> table > tbody > tr"),D=P.map((t,n)=>{let i=g[t].id,e=$(n).find("> td:nth-child(3)"),o=e.find("> strong > a"),s=o.text(),a=o.prop("href"),r=e.find("> .reply_content").text(),c=Number(e.find("span.small").text()),m=e.find("span.no").text(),p=Array.from(r.matchAll(/@(\S+)\s/g)),b=p.length>0?p.map(([,d])=>d):void 0,l=Array.from(r.matchAll(/#(\d+)/g)),x=l.length>0?l.map(([,d])=>d):void 0;return{id:i,memberName:s,memberLink:a,content:r,likes:c,floor:m,index:t,refMemberNames:b,refFloors:x}}).get();function u(){chrome.storage.sync.get("api",t=>{console.log({result:t});let n=t["api"]?.pat;n&&h.each((i,e)=>{let o=$(e);$('<button class="v2p-topic-preview-btn">\u9884\u89C8</button>').on("click",()=>{let a=o.find(".topic-link").attr("href")?.match(/\/(\d+)#/);if(a){let r=a[1];f(r,n).then(c=>{let m=c.result;$(`
                <div class="v2p-topic-preview">
                  <div class="v2p-topic-preview__title">${m.title}</div>
                  <div class="v2p-topic-preview__content">${m.content_rendered}</div>
                </div>
                `).appendTo(o)}).catch(c=>{console.error(c)})}}).prependTo(o.find(".topic_info"))})})}$("#Main .tab").addClass("v2p-hover-btn"),$('#Main .topic-link, .item_hot_topic_title > a, .item_node, a[href="/write"]').prop("target","_blank").prop("rel","noopener noreferrer");u();
