"use strict";var ht=$('#Top .tools > a[href^="/member"]').text(),gt=$("#Main > .box:nth-child(1) > .header > small > a").text(),Re=$("#Main #Tabs ~ .cell.item"),it=$("#Main .box:has(.topic_content)"),O=$('#Main .box:has(.cell[id^="r_"])'),R=O.find('.cell[id^="r_"]'),j=R.find("> table > tbody > tr"),D=j.map((t,e)=>{let o=R[t].id,n=$(e).find("> td:nth-child(3)"),i=n.find("> strong > a"),s=i.text(),r=i.prop("href"),c=n.find("> .reply_content").text(),f=Number(n.find("span.small").text()),l=n.find("span.no").text(),m=Array.from(c.matchAll(/@([a-zA-Z0-9]+)/g)),a=m.length>0?m.map(([,p])=>p):void 0,d=Array.from(c.matchAll(/#(\d+)/g)),u=d.length>0?d.map(([,p])=>p):void 0;return{id:o,memberName:s,memberLink:r,content:c,likes:f,floor:l,index:t,refMemberNames:a,refFloors:u}}).get();function vt(t){let{root:e,title:o,onOpen:n,onClose:i,onMount:s}=t,r=$('<div class="v2p-model-mask">'),c=$('<div class="v2p-model-content">'),f=$(`
    <div class="v2p-model-main">
      <div class="v2p-model-header">
        <span>${o??""}</span>
        <button class="v2p-model-close-btn normal button">\u5173\u95ED<kbd>Esc</kbd></button>
      </div>
    </div>
    `).append(c),l=r.append(f).hide(),m={$modelMask:r,$modelMain:f,$modelContainer:l,$modelContent:c},a=!1,d=h=>{$(h.target).closest(c).length===0&&p()},u=h=>{h.key==="Escape"&&p()},p=()=>{$(document).off("click",d),$(document).off("keydown",u),a=!1,l.fadeOut("fast"),document.body.classList.remove("v2p-modal-open"),i?.(m)},g=()=>{a||($(document).on("click",d),$(document).on("keydown",u),a=!0),l.fadeIn("fast"),document.body.classList.add("v2p-modal-open"),n?.(m)};return l.find(".v2p-model-close-btn").on("click",p),s?.(m),e&&e.append(l),{...m,open:g}}function X(t){return t.split("-")[1]}function yt(t){return t==="y"?"height":"width"}function L(t){return t.split("-")[0]}function U(t){return["top","bottom"].includes(L(t))?"x":"y"}function xt(t,e,o){let{reference:n,floating:i}=t,s=n.x+n.width/2-i.width/2,r=n.y+n.height/2-i.height/2,c=U(e),f=yt(c),l=n[f]/2-i[f]/2,m=L(e),a=c==="x",d;switch(m){case"top":d={x:s,y:n.y-i.height};break;case"bottom":d={x:s,y:n.y+n.height};break;case"right":d={x:n.x+n.width,y:r};break;case"left":d={x:n.x-i.width,y:r};break;default:d={x:n.x,y:n.y}}switch(X(e)){case"start":d[c]-=l*(o&&a?-1:1);break;case"end":d[c]+=l*(o&&a?-1:1);break}return d}var bt=async(t,e,o)=>{let{placement:n="bottom",strategy:i="absolute",middleware:s=[],platform:r}=o,c=s.filter(Boolean),f=await(r.isRTL==null?void 0:r.isRTL(e)),l=await r.getElementRects({reference:t,floating:e,strategy:i}),{x:m,y:a}=xt(l,n,f),d=n,u={},p=0;for(let g=0;g<c.length;g++){let{name:w,fn:h}=c[g],{x:v,y:x,data:b,reset:y}=await h({x:m,y:a,initialPlacement:n,placement:d,strategy:i,middlewareData:u,rects:l,platform:r,elements:{reference:t,floating:e}});if(m=v??m,a=x??a,u={...u,[w]:{...u[w],...b}},y&&p<=50){p++,typeof y=="object"&&(y.placement&&(d=y.placement),y.rects&&(l=y.rects===!0?await r.getElementRects({reference:t,floating:e,strategy:i}):y.rects),{x:m,y:a}=xt(l,d,f)),g=-1;continue}}return{x:m,y:a,placement:d,strategy:i,middlewareData:u}};function Kt(t){return{top:0,right:0,bottom:0,left:0,...t}}function Zt(t){return typeof t!="number"?Kt(t):{top:t,right:t,bottom:t,left:t}}function J(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function rt(t,e){var o;e===void 0&&(e={});let{x:n,y:i,platform:s,rects:r,elements:c,strategy:f}=t,{boundary:l="clippingAncestors",rootBoundary:m="viewport",elementContext:a="floating",altBoundary:d=!1,padding:u=0}=e,p=Zt(u),w=c[d?a==="floating"?"reference":"floating":a],h=J(await s.getClippingRect({element:(o=await(s.isElement==null?void 0:s.isElement(w)))==null||o?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(c.floating)),boundary:l,rootBoundary:m,strategy:f})),v=a==="floating"?{...r.floating,x:n,y:i}:r.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(c.floating)),b=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},y=J(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:v,offsetParent:x,strategy:f}):v);return{top:(h.top-y.top+p.top)/b.y,bottom:(y.bottom-h.bottom+p.bottom)/b.y,left:(h.left-y.left+p.left)/b.x,right:(y.right-h.right+p.right)/b.x}}var te=Math.min,ee=Math.max;function wt(t,e,o){return ee(t,te(e,o))}var ne={left:"right",right:"left",bottom:"top",top:"bottom"};function Q(t){return t.replace(/left|right|bottom|top/g,e=>ne[e])}function oe(t,e,o){o===void 0&&(o=!1);let n=X(t),i=U(t),s=yt(i),r=i==="x"?n===(o?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(r=Q(r)),{main:r,cross:Q(r)}}var ie={start:"end",end:"start"};function st(t){return t.replace(/start|end/g,e=>ie[e])}function se(t){let e=Q(t);return[st(t),e,st(e)]}function re(t,e,o){let n=["left","right"],i=["right","left"],s=["top","bottom"],r=["bottom","top"];switch(t){case"top":case"bottom":return o?e?i:n:e?n:i;case"left":case"right":return e?s:r;default:return[]}}function ce(t,e,o,n){let i=X(t),s=re(L(t),o==="start",n);return i&&(s=s.map(r=>r+"-"+i),e&&(s=s.concat(s.map(st)))),s}var Y=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var o;let{placement:n,middlewareData:i,rects:s,initialPlacement:r,platform:c,elements:f}=e,{mainAxis:l=!0,crossAxis:m=!0,fallbackPlacements:a,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:u="none",flipAlignment:p=!0,...g}=t,w=L(n),h=L(r)===r,v=await(c.isRTL==null?void 0:c.isRTL(f.floating)),x=a||(h||!p?[Q(r)]:se(r));!a&&u!=="none"&&x.push(...ce(r,p,u,v));let b=[r,...x],y=await rt(e,g),M=[],H=((o=i.flip)==null?void 0:o.overflows)||[];if(l&&M.push(y[w]),m){let{main:S,cross:q}=oe(n,s,v);M.push(y[S],y[q])}if(H=[...H,{placement:n,overflows:M}],!M.every(S=>S<=0)){var pt,mt;let S=(((pt=i.flip)==null?void 0:pt.index)||0)+1,q=b[S];if(q)return{data:{index:S,overflows:H},reset:{placement:q}};let F=(mt=H.filter(N=>N.overflows[0]<=0).sort((N,B)=>N.overflows[1]-B.overflows[1])[0])==null?void 0:mt.placement;if(!F)switch(d){case"bestFit":{var ut;let N=(ut=H.map(B=>[B.placement,B.overflows.filter(_=>_>0).reduce((_,Gt)=>_+Gt,0)]).sort((B,_)=>B[1]-_[1])[0])==null?void 0:ut[0];N&&(F=N);break}case"initialPlacement":F=r;break}if(n!==F)return{reset:{placement:F}}}return{}}}};async function le(t,e){let{placement:o,platform:n,elements:i}=t,s=await(n.isRTL==null?void 0:n.isRTL(i.floating)),r=L(o),c=X(o),f=U(o)==="x",l=["left","top"].includes(r)?-1:1,m=s&&f?-1:1,a=typeof e=="function"?e(t):e,{mainAxis:d,crossAxis:u,alignmentAxis:p}=typeof a=="number"?{mainAxis:a,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...a};return c&&typeof p=="number"&&(u=c==="end"?p*-1:p),f?{x:u*m,y:d*l}:{x:d*l,y:u*m}}var G=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){let{x:o,y:n}=e,i=await le(e,t);return{x:o+i.x,y:n+i.y,data:i}}}};function ae(t){return t==="x"?"y":"x"}var K=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){let{x:o,y:n,placement:i}=e,{mainAxis:s=!0,crossAxis:r=!1,limiter:c={fn:w=>{let{x:h,y:v}=w;return{x:h,y:v}}},...f}=t,l={x:o,y:n},m=await rt(e,f),a=U(L(i)),d=ae(a),u=l[a],p=l[d];if(s){let w=a==="y"?"top":"left",h=a==="y"?"bottom":"right",v=u+m[w],x=u-m[h];u=wt(v,u,x)}if(r){let w=d==="y"?"top":"left",h=d==="y"?"bottom":"right",v=p+m[w],x=p-m[h];p=wt(v,p,x)}let g=c.fn({...e,[a]:u,[d]:p});return{...g,data:{x:g.x-o,y:g.y-n}}}}};function C(t){var e;return((e=t.ownerDocument)==null?void 0:e.defaultView)||window}function A(t){return C(t).getComputedStyle(t)}var Ct=Math.min,V=Math.max,tt=Math.round;function Et(t){let e=A(t),o=parseFloat(e.width),n=parseFloat(e.height),i=t.offsetWidth,s=t.offsetHeight,r=tt(o)!==i||tt(n)!==s;return r&&(o=i,n=s),{width:o,height:n,fallback:r}}function E(t){return Pt(t)?(t.nodeName||"").toLowerCase():""}var Z;function Tt(){if(Z)return Z;let t=navigator.userAgentData;return t&&Array.isArray(t.brands)?(Z=t.brands.map(e=>e.brand+"/"+e.version).join(" "),Z):navigator.userAgent}function k(t){return t instanceof C(t).HTMLElement}function T(t){return t instanceof C(t).Element}function Pt(t){return t instanceof C(t).Node}function At(t){if(typeof ShadowRoot>"u")return!1;let e=C(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function et(t){let{overflow:e,overflowX:o,overflowY:n,display:i}=A(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+o)&&!["inline","contents"].includes(i)}function fe(t){return["table","td","th"].includes(E(t))}function ct(t){let e=/firefox/i.test(Tt()),o=A(t),n=o.backdropFilter||o.WebkitBackdropFilter;return o.transform!=="none"||o.perspective!=="none"||(n?n!=="none":!1)||e&&o.willChange==="filter"||e&&(o.filter?o.filter!=="none":!1)||["transform","perspective"].some(i=>o.willChange.includes(i))||["paint","layout","strict","content"].some(i=>{let s=o.contain;return s!=null?s.includes(i):!1})}function lt(){return/^((?!chrome|android).)*safari/i.test(Tt())}function at(t){return["html","body","#document"].includes(E(t))}function Ot(t){return T(t)?t:t.contextElement}var Lt={x:1,y:1};function I(t){let e=Ot(t);if(!k(e))return Lt;let o=e.getBoundingClientRect(),{width:n,height:i,fallback:s}=Et(e),r=(s?tt(o.width):o.width)/n,c=(s?tt(o.height):o.height)/i;return(!r||!Number.isFinite(r))&&(r=1),(!c||!Number.isFinite(c))&&(c=1),{x:r,y:c}}function z(t,e,o,n){var i,s;e===void 0&&(e=!1),o===void 0&&(o=!1);let r=t.getBoundingClientRect(),c=Ot(t),f=Lt;e&&(n?T(n)&&(f=I(n)):f=I(t));let l=c?C(c):window,m=lt()&&o,a=(r.left+(m&&((i=l.visualViewport)==null?void 0:i.offsetLeft)||0))/f.x,d=(r.top+(m&&((s=l.visualViewport)==null?void 0:s.offsetTop)||0))/f.y,u=r.width/f.x,p=r.height/f.y;if(c){let g=C(c),w=n&&T(n)?C(n):n,h=g.frameElement;for(;h&&n&&w!==g;){let v=I(h),x=h.getBoundingClientRect(),b=getComputedStyle(h);x.x+=(h.clientLeft+parseFloat(b.paddingLeft))*v.x,x.y+=(h.clientTop+parseFloat(b.paddingTop))*v.y,a*=v.x,d*=v.y,u*=v.x,p*=v.y,a+=x.x,d+=x.y,h=C(h).frameElement}}return{width:u,height:p,top:d,right:a+u,bottom:d+p,left:a,x:a,y:d}}function P(t){return((Pt(t)?t.ownerDocument:t.document)||window.document).documentElement}function nt(t){return T(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function de(t){let{rect:e,offsetParent:o,strategy:n}=t,i=k(o),s=P(o);if(o===s)return e;let r={scrollLeft:0,scrollTop:0},c={x:1,y:1},f={x:0,y:0};if((i||!i&&n!=="fixed")&&((E(o)!=="body"||et(s))&&(r=nt(o)),k(o))){let l=z(o);c=I(o),f.x=l.x+o.clientLeft,f.y=l.y+o.clientTop}return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-r.scrollLeft*c.x+f.x,y:e.y*c.y-r.scrollTop*c.y+f.y}}function Mt(t){return z(P(t)).left+nt(t).scrollLeft}function pe(t){let e=P(t),o=nt(t),n=t.ownerDocument.body,i=V(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=V(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight),r=-o.scrollLeft+Mt(t),c=-o.scrollTop;return A(n).direction==="rtl"&&(r+=V(e.clientWidth,n.clientWidth)-i),{width:i,height:s,x:r,y:c}}function W(t){if(E(t)==="html")return t;let e=t.assignedSlot||t.parentNode||At(t)&&t.host||P(t);return At(e)?e.host:e}function St(t){let e=W(t);return at(e)?e.ownerDocument.body:k(e)&&et(e)?e:St(e)}function Nt(t,e){var o;e===void 0&&(e=[]);let n=St(t),i=n===((o=t.ownerDocument)==null?void 0:o.body),s=C(n);return i?e.concat(s,s.visualViewport||[],et(n)?n:[]):e.concat(n,Nt(n))}function me(t,e){let o=C(t),n=P(t),i=o.visualViewport,s=n.clientWidth,r=n.clientHeight,c=0,f=0;if(i){s=i.width,r=i.height;let l=lt();(!l||l&&e==="fixed")&&(c=i.offsetLeft,f=i.offsetTop)}return{width:s,height:r,x:c,y:f}}function ue(t,e){let o=z(t,!0,e==="fixed"),n=o.top+t.clientTop,i=o.left+t.clientLeft,s=k(t)?I(t):{x:1,y:1},r=t.clientWidth*s.x,c=t.clientHeight*s.y,f=i*s.x,l=n*s.y;return{width:r,height:c,x:f,y:l}}function $t(t,e,o){let n;if(e==="viewport")n=me(t,o);else if(e==="document")n=pe(P(t));else if(T(e))n=ue(e,o);else{let r={...e};if(lt()){var i,s;let c=C(t);r.x-=((i=c.visualViewport)==null?void 0:i.offsetLeft)||0,r.y-=((s=c.visualViewport)==null?void 0:s.offsetTop)||0}n=r}return J(n)}function he(t,e){let o=e.get(t);if(o)return o;let n=Nt(t).filter(c=>T(c)&&E(c)!=="body"),i=null,s=A(t).position==="fixed",r=s?W(t):t;for(;T(r)&&!at(r);){let c=A(r),f=ct(r);c.position==="fixed"?i=null:(s?!f&&!i:!f&&c.position==="static"&&!!i&&["absolute","fixed"].includes(i.position))?n=n.filter(a=>a!==r):i=c,r=W(r)}return e.set(t,n),n}function ge(t){let{element:e,boundary:o,rootBoundary:n,strategy:i}=t,r=[...o==="clippingAncestors"?he(e,this._c):[].concat(o),n],c=r[0],f=r.reduce((l,m)=>{let a=$t(e,m,i);return l.top=V(a.top,l.top),l.right=Ct(a.right,l.right),l.bottom=Ct(a.bottom,l.bottom),l.left=V(a.left,l.left),l},$t(e,c,i));return{width:f.right-f.left,height:f.bottom-f.top,x:f.left,y:f.top}}function ve(t){return k(t)?Et(t):t.getBoundingClientRect()}function kt(t,e){return!k(t)||A(t).position==="fixed"?null:e?e(t):t.offsetParent}function xe(t){let e=W(t);for(;k(e)&&!at(e);){if(ct(e))return e;e=W(e)}return null}function Rt(t,e){let o=C(t),n=kt(t,e);for(;n&&fe(n)&&A(n).position==="static";)n=kt(n,e);return n&&(E(n)==="html"||E(n)==="body"&&A(n).position==="static"&&!ct(n))?o:n||xe(t)||o}function we(t,e,o){let n=k(e),i=P(e),s=z(t,!0,o==="fixed",e),r={scrollLeft:0,scrollTop:0},c={x:0,y:0};if(n||!n&&o!=="fixed")if((E(e)!=="body"||et(i))&&(r=nt(e)),k(e)){let f=z(e,!0);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else i&&(c.x=Mt(i));return{x:s.left+r.scrollLeft-c.x,y:s.top+r.scrollTop-c.y,width:s.width,height:s.height}}var ye={getClippingRect:ge,convertOffsetParentRelativeRectToViewportRelativeRect:de,isElement:T,getDimensions:ve,getOffsetParent:Rt,getDocumentElement:P,getScale:I,async getElementRects(t){let{reference:e,floating:o,strategy:n}=t,i=this.getOffsetParent||Rt,s=this.getDimensions;return{reference:we(e,await i(o),n),floating:{x:0,y:0,...await s(o)}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>A(t).direction==="rtl"};var ft=(t,e,o)=>{let n=new Map,i={platform:ye,...o},s={...i.platform,_c:n};return bt(t,e,{...i,platform:s})};var Bt=[{title:"Smileys",list:["\u{1F600}","\u{1F603}","\u{1F604}","\u{1F601}","\u{1F606}","\u{1F605}","\u{1F923}","\u{1F602}","\u{1F642}","\u{1F643}","\u{1F609}","\u{1F62E}","\u{1F632}","\u{1F633}","\u{1F631}","\u{1F62D}","\u{1F61E}","\u{1F613}","\u{1F629}","\u{1F61A}","\u{1F92D}","\u{1F60F}","\u{1F612}","\u{1F621}","\u{1F624}"]},{title:"Others",list:["\u{1F47B}","\u{1F44B}","\u{1F91A}","\u{1F590}","\u{1F596}","\u{1F436}","\u{1F414}","\u{1F921}","\u{1F4A9}"]}],dt=250,Dt=550;async function be(t,e){let o=await fetch(t,e),n=o.headers.get("X-Rate-Limit-Limit"),i=o.headers.get("X-Rate-Limit-Reset"),s=o.headers.get("X-Rate-Limit-Remaining"),r={limit:n?Number(n):void 0,reset:i?Number(i):void 0,remaining:s?Number(s):void 0};return await chrome.storage.sync.set({["legacy-api"]:r}),o.json()}function It(t,e){return be(`${"https://www.v2ex.com/api"}/members/show.json?username=${t}`,e)}function Ht(){let t=window.navigator.userAgent.toLowerCase(),e=/(macintosh|macintel|macppc|mac68k|macos)/i,o=/(win32|win64|windows|wince)/i,n=/(iphone|ipad|ipod)/i,i=null;return e.test(t)?i="macos":n.test(t)?i="ios":o.test(t)?i="windows":t.includes("android")?i="android":t.includes("linux")&&(i="linux"),i}function Ft(t){let e=new Date(t*1e3),o=e.getFullYear().toString(),n=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0");return`${o}-${n}-${i}`}var _t=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 0 24 24"
  stroke-width="1.5"
  stroke="currentColor"
  style="width:18px; height:18px;"
>
  <path
    stroke-linecap="round"
    stroke-linejoin="round"
    d="M15.182 15.182a4.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z"
  />
</svg>
`,ot=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 0 24 24"
  stroke-width="1.5"
  stroke="currentColor"
>
  <path
    stroke-linecap="round"
    stroke-linejoin="round"
    d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"
  />
</svg>
`,jt=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 0 24 24"
  stroke-width="1.5"
  stroke="currentColor"
>
  <path
    stroke-linecap="round"
    stroke-linejoin="round"
    d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"
  />
</svg>
`,Vt=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 0 24 24"
  stroke-width="1.5"
  stroke="currentColor"
>
  <path
    stroke-linecap="round"
    stroke-linejoin="round"
    d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"
  />
</svg>
`,zt=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <polygon
    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
  ></polygon>
</svg>
`,Wt=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path
    d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"
  ></path>
</svg>
`,qt=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <circle cx="12" cy="12" r="10"></circle>
  <path d="M8 15h8"></path>
  <path d="M8 9h2"></path>
  <path d="M14 9h2"></path>
</svg>
`,Jt=`
<svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path
    d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"
  ></path>
</svg>
`;function Ce(t,e){let o=$('<div id="v2p-member-popup" tabindex="0">').appendTo(O).get(0),n=null,i=c=>{$(c.target).closest(o).length===0&&s()},s=()=>{n?.abort(),o.style.visibility="hidden",o.innerHTML="",$(document).off("click",i)},r=$(t).find(".avatar");r.on("click",c=>{if(n=new AbortController,o.style.visibility==="visible")s();else{c.stopPropagation(),$(document).on("click",i);let f=r.get(0);ft(f,o,{placement:"bottom-start",middleware:[G({mainAxis:10,crossAxis:-4}),Y(),K({padding:8})]}).then(({x:a,y:d})=>{Object.assign(o.style,{left:`${a}px`,top:`${d}px`}),o.style.visibility="visible"}).catch(a=>{console.error("\u8BA1\u7B97\u4F4D\u7F6E\u5931\u8D25",a),s()});let l=$(o),m=$(`
              <div class="v2p-ctn">
                <div class="v2p-ctn-left">
                  <div class="v2p-avatar-box"></div>
                </div>

                <div class="v2p-ctn-right">
                  <div class="v2p-username v2p-loading"></div>
                  <div class="v2p-no v2p-loading"></div>
                  <div class="v2p-created-date v2p-loading"></div>
                </div>
              </div>
              `);l.append(m),setTimeout(()=>{It(e.memberName,{signal:n?.signal}).then(a=>{l.find(".v2p-avatar-box").removeClass("v2p-loading").append(`<img class="v2p-avatar" src="${a.avatar_large}">`),l.find(".v2p-username").removeClass("v2p-loading").text(a.username),l.find(".v2p-no").removeClass("v2p-loading").text(`V2EX \u7B2C ${a.id} \u53F7\u4F1A\u5458`),l.find(".v2p-created-date").removeClass("v2p-loading").text(`\u52A0\u5165\u4E8E ${Ft(a.created)}`),a.bio&&a.bio.trim().length>0&&l.append(`<div class="v2p-bio">${a.bio}</div>`)}).catch(a=>{a.name!=="AbortError"&&l.html("<span>\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25</span>")})},0)}})}function Qt(t){let e=$(t);if(e.find(".v2p-reply-content").length>0)return;let o=e.find(".reply_content");if((o.height()??0)+dt>=Dt){let s={maxHeight:`${dt}px`,overflow:"hidden",paddingBottom:"0"},r=$('<div class="v2p-reply-content v2p-collapsed">').css(s),c=$('<button class="v2p-expand-btn normal button">\u5C55\u5F00\u56DE\u590D</button>'),f=()=>{let l=r.hasClass("v2p-collapsed");r.toggleClass("v2p-collapsed").css(l?{maxHeight:"none",overflow:"auto",paddingBottom:"40px"}:s),c.html(l?"\u6536\u8D77\u56DE\u590D":"\u5C55\u5F00\u56DE\u590D")};c.on("click",()=>{f()}),r.append(o.clone()).replaceAll(o).append(c)}}function Ae(){let t=D.filter(({likes:o})=>o>0).sort((o,n)=>n.likes-o.likes);if(t.length<=0)return;let e=vt({root:O,title:`\u672C\u9875\u5171\u6709 ${t.length} \u6761\u70ED\u95E8\u56DE\u590D`,onMount:({$modelContent:o})=>{let n=$("<templete></templete>");t.forEach(({index:i})=>{n.append(R.eq(i).clone())}),o.append(n.html())},onOpen:({$modelContainer:o})=>{o.find('.cell[id^="r_"]').each((n,i)=>{Qt(i)})}});{let o=O.find(".cell:first-of-type > span.gray"),n=o.text(),s=`<span class="count-text">${n.substring(0,n.indexOf("\u56DE\u590D")+2)}</span><span class="v2p-dot">\xB7</span>`,r=$(`<span class="v2p-popular-btn v2p-hover-btn"><span class="v2p-icon-heart">${ot}</span>\u67E5\u770B\u672C\u9875\u611F\u8C22\u56DE\u590D</span>`);r.on("click",c=>{c.stopPropagation(),e.open()}),o.empty().append(s).append(r)}}function $e(){j.find("> td:last-of-type > .fr").each((e,o)=>{let n=$(o),i=$('<span class="v2p-controls">'),s=$(`<span class="v2p-control">${ot}</span>`),r=n.find("> .thank_area");if(r.hasClass("thanked"))s.prop("title","\u5DF2\u611F\u8C22").css({color:"#f43f5e",cursor:"default"}),i.append($("<a>").append(s));else{let m=r.find("> .thank"),a=m.eq(0).removeClass("thank"),d=m.eq(1).removeClass("thank");a.html(`<span class="v2p-control v2p-hover-btn" title="\u9690\u85CF">${jt}</span>`),s.prop("title","\u611F\u8C22").addClass("v2p-hover-btn"),d.empty().append(s),i.append(a).append(d)}let f=n.find("a:last-of-type");f.find('> img[alt="Reply"]').replaceWith(`<span class="v2p-control v2p-ac-reply v2p-hover-btn" title="\u56DE\u590D">${Vt}</span>`),i.append(f),r.remove();let l=n.find(".no").clone();n.empty().append(i,l)})}function ke(){let t=Ht(),e=document.querySelector("#reply_content"),o=$(`<button class="normal button">\u56DE\u590D<kbd>${t==="macos"?"Cmd":"Ctrl"}+Enter</kbd></button>`).replaceAll($('#reply-box input[type="submit"]')),n=$('<div class="v2p-emoji-group">'),i=$('<div class="v2p-emoji-list">'),s=$('<span class="v2p-emoji">'),r=Bt.map(p=>{let g=n.clone();g.append(`<div class="v2p-emoji-title">${p.title}</div>`);let w=i.clone().append(p.list.map(h=>s.clone().text(h).on("click",()=>{if(e instanceof HTMLTextAreaElement){let x=e.selectionStart,b=e.selectionEnd,y=e.value.substring(0,x),M=e.value.substring(b,e.value.length);e.value=`${y}${h}${M}`,e.focus(),e.selectionStart=e.selectionEnd=x+h.length}})));return g.append(w),g}),c=$('<div class="v2p-emoticons-box">').append(r),f=$(`<button type="button" class="normal button">${_t}</button>`).insertAfter(o),l=$('<div id="v2p-emoji-popup">').append(c).appendTo($("#reply-box")).get(0),m=p=>{p.key==="Escape"&&(p.stopPropagation(),d())},a=p=>{$(p.target).closest(l).length===0&&d()},d=()=>{l.style.visibility="hidden",$(document).off("click",a),$("body").off("keydown",m)},u=()=>{$(document).on("click",a),$("body").on("keydown",m),ft(f.get(0),l,{placement:"right-end",middleware:[G({mainAxis:10,crossAxis:8}),Y(),K({padding:8})]}).then(({x:p,y:g})=>{Object.assign(l.style,{left:`${p}px`,top:`${g}px`}),l.style.visibility="visible"}).catch(()=>{d()})};f.on("click",p=>{p.stopPropagation(),l.style.visibility==="visible"?d():u(),e instanceof HTMLTextAreaElement&&e.focus()})}function Xt(){R.find(".small.fade").addClass("v2p-heart-box").find('img[alt="\u2764\uFE0F"]').replaceWith(`<span class="v2p-icon-heart">${ot}</span>`),$e(),Ae(),R.each((t,e)=>{let o=D.at(t);o&&Ce(e,o),Qt(e);let n=o?.id===e.id?o:D.find(i=>i.id===e.id);if(n){let{memberName:i,refMemberNames:s,refFloors:r}=n;if(i===ht&&i!==gt&&$(e).find(".badges").append('<div class="badge you">YOU</div>'),!s||s.length===0)return;for(let c of s)for(let f=t-1;f>=0;f--){let{memberName:l,floor:m}=D.at(f)||{};if(l===c){let a=r?.at(0);if(a&&a!==m){let d=D.slice(0,f).findIndex(u=>u.floor===a);if(d>=0){R.eq(d).append(e);return}}R.eq(f).append(e);return}}}}),ke()}function Ut(){it.find(".topic_content a[href]").prop("target","_blank").prop("rel","noopener noreferrer");{let t=it.find(".subtle > .topic_content"),e=t.text().length;e>=200&&t.each((o,n)=>{e>=400&&(n.style.fontSize="13px"),n.style.fontSize="14px"})}{let t=$(".topic_buttons .tb").addClass("v2p-tb v2p-hover-btn");t.eq(0).append(`<span class="v2p-tb-icon">${zt}</span>`),t.eq(1).append(`<span class="v2p-tb-icon">${Wt}</span>`),t.eq(2).append(`<span class="v2p-tb-icon">${qt}</span>`),t.eq(3).append(`<span class="v2p-tb-icon">${Jt}</span>`)}}function Yt(){let t=O.find('> .cell:not([id^="r_"])');if(t.length<=1)return;let o=t.slice(1).addClass("v2p-paging").find(".super.button");o.eq(0).addClass("v2p-prev-btn"),o.eq(1).addClass("v2p-next-btn")}j.find("> td:nth-child(3) > strong > a").prop("target","_blank").prop("rel","noopener noreferrer");$(document).on("keydown",t=>{if(t.key==="Escape"){let e=$("#reply-box"),o=$("#reply_content");e.hasClass("reply-box-sticky")&&(e.removeClass("reply-box-sticky"),$("#undock-button").css("display","none")),o.trigger("blur")}});Ut();if(document.referrer!==""&&document.referrer.includes(document.location.pathname)){let e=new URL(document.location.href).searchParams.get("p");e&&e!=="1"&&document.querySelector(".topic_buttons")?.scrollIntoView({behavior:"smooth"})}Xt();Yt();
